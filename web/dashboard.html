<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Veridian AI â€” Control Panel</title>
  <link rel="icon" type="image/png" href="assets/logo veridian ai.png">
  <link rel="apple-touch-icon" href="assets/logo veridian ai.png">
  <link rel="stylesheet" href="css/dashboard.css">
  <script src="js/i18n.js" defer></script>
  <script src="js/dashboard.js" defer></script>
</head>
<body>

<!-- â•â• MODAL: TRANSCRIPT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="transcript-modal" style="display:none;position:fixed;inset:0;z-index:10000;background:rgba(0,0,0,.7);align-items:center;justify-content:center;backdrop-filter:blur(4px)">
  <div style="background:var(--bg2);border:1px solid var(--border);border-radius:12px;width:min(640px,90vw);max-height:80vh;display:flex;flex-direction:column">
    <div style="padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between">
      <div style="font-family:'Space Mono',monospace;font-size:13px;font-weight:700;color:var(--text)" id="transcript-title">Transcription</div>
      <button onclick="closeTranscriptModal()" style="background:none;border:none;color:var(--text3);cursor:pointer;font-size:18px;line-height:1">Ã—</button>
    </div>
    <div id="transcript-content" style="padding:20px;overflow-y:auto;font-size:12.5px;line-height:1.7;color:var(--text2);white-space:pre-wrap;font-family:'Space Mono',monospace;flex:1"></div>
    <div style="padding:12px 20px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:8px">
      <button class="btn btn-ghost btn-sm" onclick="closeTranscriptModal()">Fermer</button>
    </div>
  </div>
</div>

<!-- â•â• LOGIN SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-screen" style="display:none;position:fixed;inset:0;background:var(--bg);
     z-index:9999;flex-direction:column;align-items:center;justify-content:center;gap:20px;">
  <img src="assets/logo veridian ai.png" alt="Veridian AI" style="height:52px;width:auto;margin-bottom:12px;opacity:0.8">
  <div style="font-family:'Space Mono',monospace;font-size:22px;font-weight:700;color:var(--text);text-align:center">
    Veridian <span style="color:var(--accent)">AI</span>
  </div>
  <div style="font-size:14px;color:var(--text3);font-family:'Space Mono',monospace;text-align:center">
    Connectez-vous pour accÃ©der au panel d'administration
  </div>
  <button onclick="loginWithDiscord()" style="margin-top:16px;padding:12px 32px;background:#5865F2;color:white;border:none;border-radius:6px;font-weight:600;cursor:pointer;font-size:14px;display:flex;align-items:center;gap:10px;transition:background 0.2s" onmouseover="this.style.background='#4752C4'" onmouseout="this.style.background='#5865F2'">
    <svg width="18" height="14" viewBox="0 0 16 12" fill="none">
      <path d="M13.54 1.02A13.27 13.27 0 0010.34 0c-.14.26-.3.6-.41.88a12.3 12.3 0 00-3.86 0A9.5 9.5 0 005.66 0 13.34 13.34 0 002.45 1.03C.35 4.18-.22 7.24.07 10.26a13.4 13.4 0 004.09 2.07 10.07 10.07 0 00.87-1.42 8.7 8.7 0 01-1.37-.66c.11-.08.23-.17.33-.25a9.55 9.55 0 008.02 0c.11.09.22.17.33.25a8.8 8.8 0 01-1.38.67c.25.5.54.98.87 1.42a13.35 13.35 0 004.1-2.07c.34-3.53-.57-6.57-2.39-9.25z" fill="currentColor"/>
    </svg>
    Se connecter avec Discord
  </button>
  <div style="font-size:11px;color:var(--text3);margin-top:20px;text-align:center;max-width:300px">
    Vous serez redirigÃ© vers Discord pour authentifier votre compte.<br>
    Vous ne pouvez accÃ©der qu'aux serveurs oÃ¹ vous Ãªtes administrateur.
  </div>
</div>

<!-- â•â• BETA BANNER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="beta-banner">
  <span class="beta-pill">BETA</span>
  <span>0.0.1 â€” Version en cours de dÃ©veloppement Â· 2026</span>
  <a href="#">Signaler un problÃ¨me sur Discord â†’</a>
</div>

<div class="app" id="app">

  <!-- â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <aside class="sidebar">

    <a href="index.html" class="sidebar-logo">
      <img src="assets/logo veridian ai.png" alt="Veridian AI" style="height:32px;width:auto">
    </a>

    <!-- Server selector -->
    <div style="padding:8px 8px 0;position:relative">
      <div class="server-selector" id="server-selector-display" style="cursor:pointer">
        <div class="server-avatar">ğŸŒ¿</div>
        <div class="server-info">
          <div class="server-name">Chargement...</div>
          <div class="server-plan">â€”</div>
        </div>
        <svg class="server-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none">
          <path d="M3 4.5l3 3 3-3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </div>
      <!-- Dropdown serveurs -->
      <div id="server-dropdown" style="display:none;position:absolute;top:calc(100% + 4px);left:8px;right:8px;background:var(--bg2);border:1px solid var(--border);border-radius:8px;z-index:100;max-height:200px;overflow-y:auto;box-shadow:0 8px 24px rgba(0,0,0,.4)">
        <!-- PeuplÃ© dynamiquement par JS -->
        <div style="padding:10px;color:var(--text3);font-size:12px;text-align:center">Chargement des serveursâ€¦</div>
      </div>
    </div>

    <!-- Nav: Main -->
    <div class="nav-group">
      <span class="nav-group-label">Main</span>
      <div class="nav-item active" data-page="dashboard" data-super-admin style="display:none">
        <svg class="nav-icon" viewBox="0 0 14 14" fill="none">
          <rect x="1" y="1" width="5" height="5" rx="1.2" fill="currentColor"/>
          <rect x="8" y="1" width="5" height="5" rx="1.2" fill="currentColor" opacity=".5"/>
          <rect x="1" y="8" width="5" height="5" rx="1.2" fill="currentColor" opacity=".5"/>
          <rect x="8" y="8" width="5" height="5" rx="1.2" fill="currentColor" opacity=".5"/>
        </svg>
        Dashboard
      </div>
      <div class="nav-item" data-page="tickets">
        <svg class="nav-icon" viewBox="0 0 14 14" fill="none">
          <path d="M2 3.5A1.5 1.5 0 013.5 2h7A1.5 1.5 0 0112 3.5v1a1 1 0 000 2v1A1.5 1.5 0 0110.5 9h-7A1.5 1.5 0 012 7.5v-1a1 1 0 000-2v-1z" fill="currentColor" opacity=".7"/>
        </svg>
        Tickets
        <span class="nav-badge" data-badge="tickets">â€”</span>
      </div>
      <div class="nav-item" data-page="orders" data-super-admin style="display:none">
        <svg class="nav-icon" viewBox="0 0 14 14" fill="none">
          <rect x="1.5" y="1.5" width="11" height="11" rx="1.5" fill="currentColor" opacity=".3"/>
          <path d="M4 5h6M4 7h4M4 9h2.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
        </svg>
        Orders
        <span class="nav-badge yellow" data-badge="orders">â€”</span>
      </div>
    </div>

    <div class="nav-sep"></div>

    <!-- Nav: Config -->
    <div class="nav-group">
      <span class="nav-group-label">Config</span>
      <div class="nav-item" data-page="settings">
        <svg class="nav-icon" viewBox="0 0 14 14" fill="none">
          <circle cx="7" cy="7" r="2" fill="currentColor"/>
          <path d="M7 1.5v1.2M7 11.3v1.2M1.5 7h1.2M11.3 7h1.2M3.1 3.1l.85.85M10.05 10.05l.85.85M3.1 10.9l.85-.85M10.05 3.95l.85-.85" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
        </svg>
        Settings
      </div>
      <div class="nav-item" data-page="kb" data-super-admin style="display:none">
        <svg class="nav-icon" viewBox="0 0 14 14" fill="none">
          <path d="M2.5 2h6.5l2.5 2.5V12a.5.5 0 01-.5.5h-8.5A.5.5 0 012 12V2.5A.5.5 0 012.5 2z" fill="currentColor" opacity=".4"/>
          <path d="M4.5 6.5h5M4.5 8.5h3.5" stroke="currentColor" stroke-width="1.1" stroke-linecap="round"/>
        </svg>
        Knowledge Base
      </div>
    </div>

    <!-- Nav: Super Admin (cachÃ© pour non-super-admin) -->
    <div class="nav-group" data-super-admin style="display:none">
      <span class="nav-group-label">Super Admin</span>
      <div class="nav-item" data-page="superadmin">
        <svg class="nav-icon" viewBox="0 0 14 14" fill="none">
          <path d="M7 1l1.6 3.3L12 5l-2.5 2.4.6 3.4L7 9.2 3.9 10.8l.6-3.4L2 5l3.4-.7L7 1z" fill="currentColor"/>
        </svg>
        Super Admin ğŸ‘‘
      </div>
    </div>

    <!-- User -->
    <div class="sidebar-footer">
      <div class="user-card">
        <img class="user-avatar-img" src="" alt="" style="width:32px;height:32px;border-radius:50%;object-fit:cover;background:var(--surface)">
        <div style="flex:1;min-width:0">
          <div class="user-name">Chargement...</div>
          <div class="user-role">â€”</div>
        </div>
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none" title="DÃ©connexion" onclick="logout()" style="cursor:pointer;opacity:.4;flex-shrink:0;transition:opacity .2s" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='.4'">
          <path d="M5.5 3.5H3a.5.5 0 00-.5.5v6a.5.5 0 00.5.5h2.5M9 5l2.5 2L9 9M5.5 7h6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
    </div>
  </aside>

  <!-- â•â• MAIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="main">

    <!-- Topbar -->
    <div class="topbar">
      <div style="font-family:'Space Mono',monospace;font-size:11px;display:flex;align-items:center;gap:5px">
        <span style="color:var(--text3)">veridian</span>
        <span class="breadcrumb-sep" style="color:var(--text3)">/</span>
        <span id="breadcrumb-page" style="color:var(--text);font-weight:700">Dashboard</span>
      </div>
      <div style="font-size:11px;color:var(--text3);font-family:'Space Mono',monospace;margin-left:12px" id="topbar-sub">Vue d'ensemble</div>
      <div class="topbar-right">
        <div class="status-indicator">
          <div class="status-dot"></div>
          BOT EN LIGNE
        </div>
        <a href="index.html" class="topbar-btn">
          <svg width="11" height="11" viewBox="0 0 11 11" fill="none">
            <path d="M1 5.5h9M5.5 1L1 5.5l4.5 4.5" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Site
        </a>
        <button class="topbar-btn" onclick="logout()" title="DÃ©connexion">
          <svg width="11" height="11" viewBox="0 0 11 11" fill="none">
            <path d="M1 5.5h6M7.5 2l2.5 3.5L7.5 9" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          DÃ©connexion
        </button>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PAGE â€” DASHBOARD
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page-content active" id="page-dashboard">

      <div class="page-header">
        <div>
          <div class="page-title">Dashboard</div>
          <div class="page-sub" id="topbar-date">Chargementâ€¦</div>
        </div>
        <div class="page-actions">
          <button class="btn btn-ghost btn-sm" onclick="loadDashboardStats()">â†» RafraÃ®chir</button>
        </div>
      </div>

      <!-- Stats row -->
      <div class="stats-row">
        <div class="stat-card c-green">
          <div class="stat-top"><div class="stat-label">Tickets actifs</div><div class="stat-icon c-green">ğŸ«</div></div>
          <div class="stat-value" id="stat-tickets-actifs">â€”</div>
          <div class="stat-delta up">Ouverts en ce moment</div>
        </div>
        <div class="stat-card c-blue">
          <div class="stat-top"><div class="stat-label">Tickets ce mois</div><div class="stat-icon c-blue">ğŸ“Š</div></div>
          <div class="stat-value" id="stat-tickets-mois">â€”</div>
          <div class="stat-delta up">Total cumulÃ©</div>
        </div>
        <div class="stat-card c-yellow">
          <div class="stat-top"><div class="stat-label">Commandes en attente</div><div class="stat-icon c-yellow">â³</div></div>
          <div class="stat-value" id="stat-orders-attente">â€”</div>
          <div class="stat-delta">Ã€ valider manuellement</div>
        </div>
        <div class="stat-card c-red">
          <div class="stat-top"><div class="stat-label">Langues dÃ©tectÃ©es</div><div class="stat-icon c-red">ğŸŒ</div></div>
          <div class="stat-value">9</div>
          <div class="stat-delta">Ce mois â€” 100+ supportÃ©es</div>
        </div>
      </div>

      <!-- Charts row -->
      <div class="grid-3-2">
        <div class="card">
          <div class="card-header">
            <div class="card-title"><div class="card-dot"></div>Tickets â€” 7 derniers jours</div>
            <div class="card-meta">TICKETS / JOUR</div>
          </div>
          <div class="card-body">
            <div id="bar-chart" class="bar-chart"></div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <div class="card-title"><div class="card-dot"></div>Langues</div>
            <div class="card-meta">CE MOIS</div>
          </div>
          <div class="card-body">
            <div id="lang-stats">
              <!-- PeuplÃ© par renderLanguageStats() -->
              <div class="progress-item">
                <div class="progress-header"><div class="progress-label">ğŸ‡¬ğŸ‡§ Anglais</div><div class="progress-pct">â€”</div></div>
                <div class="progress-track"><div class="progress-fill" data-width="0%" style="width:0"></div></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ActivitÃ© rÃ©cente -->
      <div class="card">
        <div class="card-header">
          <div class="card-title"><div class="card-dot"></div>ActivitÃ© rÃ©cente</div>
          <button class="btn btn-ghost btn-sm btn-xs" onclick="navigateTo('tickets')">Tout voir</button>
        </div>
        <div class="card-body" id="activity-recent">
          <div style="color:var(--text3);font-size:12px;text-align:center;padding:20px">Chargementâ€¦</div>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PAGE â€” TICKETS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page-content" id="page-tickets">

      <div class="page-header">
        <div>
          <div class="page-title">Tickets</div>
          <div class="page-sub">Support â€” liste complÃ¨te</div>
        </div>
        <div class="page-actions">
          <input id="ticket-search" class="form-input" type="text" placeholder="ğŸ” Rechercher par ID, user, statutâ€¦" style="width:220px;padding:6px 10px;font-size:12px">
          <button class="btn btn-ghost btn-sm" onclick="loadTickets()">â†» RafraÃ®chir</button>
        </div>
      </div>

      <!-- Filtres statut -->
      <div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap">
        <button class="btn btn-ghost btn-sm active" data-ticket-filter="all">Tous</button>
        <button class="btn btn-ghost btn-sm" data-ticket-filter="open">Ouverts</button>
        <button class="btn btn-ghost btn-sm" data-ticket-filter="in_progress">En cours</button>
        <button class="btn btn-ghost btn-sm" data-ticket-filter="closed">FermÃ©s</button>
      </div>

      <div class="card">
        <div class="card-body no-pad">
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Utilisateur</th>
                <th>Statut</th>
                <th>Langue</th>
                <th>AssignÃ© Ã </th>
                <th>Ouvert le</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="tickets-tbody">
              <tr><td colspan="7" style="text-align:center;color:var(--text3);padding:32px">SÃ©lectionnez un serveur pour voir les tickets</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PAGE â€” ORDERS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page-content" id="page-orders">

      <div class="page-header">
        <div>
          <div class="page-title">Orders</div>
          <div class="page-sub">Commandes en attente de validation manuelle</div>
        </div>
        <div class="page-actions">
          <button class="btn btn-ghost btn-sm" onclick="loadOrders()">â†» RafraÃ®chir</button>
        </div>
      </div>

      <div class="grid-2">
        <div class="card">
          <div class="card-header">
            <div class="card-title"><div class="card-dot"></div>En attente</div>
            <button class="btn btn-ghost btn-sm btn-xs" onclick="loadOrders()">â†»</button>
          </div>
          <div class="card-body" id="orders-list">
            <div style="color:var(--text3);font-size:13px;text-align:center;padding:24px">Chargementâ€¦</div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title"><div class="card-dot"></div>LÃ©gende</div>
          </div>
          <div class="card-body">
            <div style="display:flex;flex-direction:column;gap:10px">
              <div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface);border-radius:8px;border:1px solid var(--border2)">
                <div style="font-size:18px">âœ…</div>
                <div>
                  <div style="font-size:12.5px;font-weight:600;color:var(--accent)">PayÃ©</div>
                  <div style="font-size:11px;color:var(--text3)">Active le plan, notifie l'utilisateur en DM</div>
                </div>
              </div>
              <div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface);border-radius:8px;border:1px solid var(--border2)">
                <div style="font-size:18px">âš ï¸</div>
                <div>
                  <div style="font-size:12.5px;font-weight:600;color:var(--yellow)">Montant incomplet</div>
                  <div style="font-size:11px;color:var(--text3)">DM Ã  l'utilisateur pour envoyer le reste</div>
                </div>
              </div>
              <div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--surface);border-radius:8px;border:1px solid var(--border2)">
                <div style="font-size:18px">âŒ</div>
                <div>
                  <div style="font-size:12.5px;font-weight:600;color:var(--red)">RejetÃ©</div>
                  <div style="font-size:11px;color:var(--text3)">Annule la commande, notifie l'utilisateur</div>
                </div>
              </div>
            </div>
            <div style="margin-top:16px;padding:12px;background:var(--accent-dim2);border:1px solid rgba(45,255,143,0.1);border-radius:8px">
              <div style="font-size:10px;font-family:'Space Mono',monospace;color:var(--accent);margin-bottom:6px">â„¹ï¸ RAPPEL</div>
              <div style="font-size:11.5px;color:var(--text2);line-height:1.5">Chaque action envoie automatiquement un DM Discord Ã  l'utilisateur via le bot.</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Historique -->
      <div class="card">
        <div class="card-header">
          <div class="card-title"><div class="card-dot"></div>Historique rÃ©cent</div>
          <div class="card-meta">30 DERNIERS JOURS</div>
        </div>
        <div class="card-body no-pad">
          <table class="data-table" id="orders-history">
            <thead>
              <tr><th>Order ID</th><th>Utilisateur</th><th>MÃ©thode</th><th>Plan</th><th>Montant</th><th>Statut</th><th>Date</th></tr>
            </thead>
            <tbody>
              <tr><td colspan="7" style="text-align:center;color:var(--text3);padding:24px">Chargement de l'historiqueâ€¦</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PAGE â€” SETTINGS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page-content" id="page-settings">

      <div class="page-header">
        <div>
          <div class="page-title">Settings</div>
          <div class="page-sub">Configuration du bot pour ce serveur</div>
        </div>
        <div class="page-actions">
          <button class="btn btn-primary btn-sm" id="settings-save-btn">Sauvegarder</button>
        </div>
      </div>

      <div class="grid-2">

        <!-- Bot Config -->
        <div class="card">
          <div class="card-header">
            <div class="card-title"><div class="card-dot"></div>Configuration du bot</div>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label class="form-label">Channel support public IA</label>
              <input class="form-input" id="settings-support-channel" type="text" placeholder="#nom-du-channel ou ID">
              <div style="font-size:10px;color:var(--text3);margin-top:4px">ID numÃ©rique ou #nom du channel Discord</div>
            </div>
            <div class="form-group">
              <label class="form-label">CatÃ©gorie tickets</label>
              <input class="form-input" id="settings-ticket-category" type="text" placeholder="ID de la catÃ©gorie">
            </div>
            <div class="form-group">
              <label class="form-label">RÃ´le Staff</label>
              <input class="form-input" id="settings-staff-role" type="text" placeholder="@NomDuRole ou ID">
            </div>
            <div class="form-group">
              <label class="form-label">Channel de logs</label>
              <input class="form-input" id="settings-log-channel" type="text" placeholder="#logs-bot ou ID">
            </div>
            <div class="form-group">
              <label class="form-label">Langue par dÃ©faut du staff</label>
              <select class="form-select" id="settings-default-lang">
                <option value="en">ğŸ‡¬ğŸ‡§ Anglais (en)</option>
                <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais (fr)</option>
                <option value="de">ğŸ‡©ğŸ‡ª Allemand (de)</option>
                <option value="es">ğŸ‡ªğŸ‡¸ Espagnol (es)</option>
                <option value="it">ğŸ‡®ğŸ‡¹ Italien (it)</option>
                <option value="pt">ğŸ‡µğŸ‡¹ Portugais (pt)</option>
                <option value="ru">ğŸ‡·ğŸ‡º Russe (ru)</option>
                <option value="ja">ğŸ‡¯ğŸ‡µ Japonais (ja)</option>
                <option value="zh">ğŸ‡¨ğŸ‡³ Chinois (zh)</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Feature toggles -->
        <div class="card">
          <div class="card-header">
            <div class="card-title"><div class="card-dot"></div>FonctionnalitÃ©s</div>
          </div>
          <div class="card-body">
            <div class="toggle-row">
              <div class="toggle-info">
                <div class="toggle-name">Traduction automatique</div>
                <div class="toggle-desc">Traduit les messages entre staff et utilisateurs</div>
              </div>
              <div class="toggle-switch on"></div>
            </div>
            <div class="toggle-row">
              <div class="toggle-info">
                <div class="toggle-name">Support public IA</div>
                <div class="toggle-desc">RÃ©ponses automatiques dans le channel dÃ©signÃ©</div>
              </div>
              <div class="toggle-switch on"></div>
            </div>
            <div class="toggle-row">
              <div class="toggle-info">
                <div class="toggle-name">Transcription IA</div>
                <div class="toggle-desc">RÃ©sumÃ© automatique Ã  la fermeture des tickets</div>
              </div>
              <div class="toggle-switch on"></div>
            </div>
            <div class="toggle-row">
              <div class="toggle-info">
                <div class="toggle-name">ModÃ©ration IA</div>
                <div class="toggle-desc">DÃ©tection automatique de contenu inappropriÃ©</div>
              </div>
              <div class="toggle-switch on"></div>
            </div>
            <div class="toggle-row">
              <div class="toggle-info">
                <div class="toggle-name">Suggestions staff IA</div>
                <div class="toggle-desc">Suggestions de rÃ©ponses pour les agents<br><span style="font-size:10px;color:var(--accent);font-family:'Space Mono',monospace">PRO UNIQUEMENT</span></div>
              </div>
              <div class="toggle-switch" style="opacity:0.4;pointer-events:none"></div>
            </div>

            <div style="margin-top:16px;padding:12px;background:var(--blue-dim);border:1px solid rgba(77,166,255,0.15);border-radius:8px;display:flex;align-items:center;justify-content:space-between;gap:10px">
              <div>
                <div style="font-size:11px;font-family:'Space Mono',monospace;color:var(--blue);margin-bottom:3px">PLAN ACTUEL</div>
                <div style="font-size:13px;font-weight:700;color:var(--text)">Premium <span style="color:var(--text3);font-weight:400">â€” 2â‚¬/mois</span></div>
              </div>
              <button class="btn btn-ghost btn-sm" style="font-size:11px" onclick="navigateTo('orders')">Upgrader â†’</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PAGE â€” KNOWLEDGE BASE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page-content" id="page-kb">

      <div class="page-header">
        <div>
          <div class="page-title">Knowledge Base</div>
          <div class="page-sub">Base de connaissances pour l'IA de support</div>
        </div>
        <div class="page-actions">
          <button class="btn btn-primary btn-sm" id="kb-add-btn">+ Ajouter une entrÃ©e</button>
        </div>
      </div>

      <!-- Formulaire add/edit (hidden by default) -->
      <div id="kb-form" style="display:none;margin-bottom:16px">
        <input type="hidden" id="kb-form-id">
        <div class="card">
          <div class="card-header">
            <div class="card-title"><div class="card-dot"></div><span id="kb-form-title">Nouvelle entrÃ©e</span></div>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label class="form-label">Question</label>
              <input class="form-input" id="kb-form-q" type="text" placeholder="Ex: Comment rejoindre le serveur Minecraft ?">
            </div>
            <div class="form-group">
              <label class="form-label">RÃ©ponse</label>
              <textarea class="form-input" id="kb-form-a" rows="3" placeholder="Ex: Connecte-toi avec l'IP play.monserveur.comâ€¦" style="resize:vertical;font-family:'DM Sans',sans-serif"></textarea>
            </div>
            <div style="display:flex;gap:8px">
              <button class="btn btn-primary btn-sm" id="kb-save-btn">Sauvegarder</button>
              <button class="btn btn-ghost btn-sm" onclick="document.getElementById('kb-form').style.display='none'">Annuler</button>
            </div>
          </div>
        </div>
      </div>

      <!-- KB entries -->
      <div class="card">
        <div class="card-header">
          <div class="card-title"><div class="card-dot"></div>EntrÃ©es actuelles</div>
          <div class="card-meta" data-kb-counter>0 / 50 ENTRÃ‰ES</div>
        </div>
        <div class="card-body">
          <div id="kb-entries">
            <div style="color:var(--text3);font-size:13px;text-align:center;padding:24px">SÃ©lectionnez un serveur pour voir la base de connaissances</div>
          </div>
          <div style="margin-top:16px;padding:12px;background:var(--surface);border-radius:8px;border:1px solid var(--border)">
            <div style="display:flex;justify-content:space-between;margin-bottom:6px">
              <span style="font-size:11px;font-family:'Space Mono',monospace;color:var(--text3)">CAPACITÃ‰ UTILISÃ‰E</span>
              <span style="font-size:11px;font-family:'Space Mono',monospace;color:var(--accent)" data-kb-counter>0 / 50</span>
            </div>
            <div class="progress-track">
              <div class="progress-fill" data-kb-fill data-width="0%" style="width:0"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         PAGE â€” SUPER ADMIN (Bot Owner only)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page-content" id="page-superadmin">

      <div class="page-header">
        <div>
          <div class="page-title">Super Admin ğŸ‘‘</div>
          <div class="page-sub">Panel global â€” Bot Owner uniquement</div>
        </div>
        <div class="page-actions">
          <button class="btn btn-ghost btn-sm" onclick="loadSuperAdminData()">â†» RafraÃ®chir</button>
        </div>
      </div>

      <!-- Stats globales -->
      <div class="stats-row">
        <div class="stat-card c-green">
          <div class="stat-top"><div class="stat-label">Serveurs</div><div class="stat-icon c-green">ğŸ </div></div>
          <div class="stat-value" id="admin-stat-servers">â€”</div>
          <div class="stat-delta">Veridian AI installÃ©</div>
        </div>
        <div class="stat-card c-blue">
          <div class="stat-top"><div class="stat-label">Utilisateurs</div><div class="stat-icon c-blue">ğŸ‘¥</div></div>
          <div class="stat-value" id="admin-stat-users">â€”</div>
          <div class="stat-delta">Total en DB</div>
        </div>
        <div class="stat-card c-yellow">
          <div class="stat-top"><div class="stat-label">Tickets aujourd'hui</div><div class="stat-icon c-yellow">ğŸ«</div></div>
          <div class="stat-value" id="admin-stat-tickets">â€”</div>
          <div class="stat-delta">Tous serveurs</div>
        </div>
        <div class="stat-card c-red">
          <div class="stat-top"><div class="stat-label">Revenus ce mois</div><div class="stat-icon c-red">ğŸ’°</div></div>
          <div class="stat-value" id="admin-stat-revenue">â€”</div>
          <div class="stat-delta">PayPal + OxaPay + GC</div>
        </div>
      </div>

      <!-- Bot status row -->
      <div class="grid-2" style="margin-bottom:0">
        <div class="card">
          <div class="card-header">
            <div class="card-title"><div class="card-dot"></div>Bot â€” Uptime</div>
            <div class="card-meta">TEMPS DE FONCTIONNEMENT</div>
          </div>
          <div class="card-body" style="display:flex;align-items:center;gap:12px">
            <span style="font-size:28px">â±ï¸</span>
            <div>
              <div style="font-size:22px;font-weight:700;color:var(--accent);font-family:'Space Mono',monospace" id="admin-bot-uptime">â€”</div>
              <div style="font-size:11px;color:var(--text3);margin-top:2px">Depuis le dernier redÃ©marrage</div>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <div class="card-title"><div class="card-dot"></div>Bot â€” Version</div>
            <div class="card-meta">BUILD ACTUEL</div>
          </div>
          <div class="card-body" style="display:flex;align-items:center;gap:12px">
            <span style="font-size:28px">ğŸ§©</span>
            <div>
              <div style="font-size:22px;font-weight:700;color:var(--blue);font-family:'Space Mono',monospace" id="admin-bot-version">â€”</div>
              <div style="font-size:11px;color:var(--text3);margin-top:2px">Version dÃ©ployÃ©e</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Commandes en attente (toutes) -->
      <div class="card">
        <div class="card-header">
          <div class="card-title"><div class="card-dot"></div>Toutes les commandes en attente</div>
          <button class="btn btn-ghost btn-sm btn-xs" onclick="loadSuperAdminData()">â†»</button>
        </div>
        <div class="card-body" id="admin-orders-list">
          <div style="color:var(--text3);font-size:13px;text-align:center;padding:24px">Chargementâ€¦</div>
        </div>
      </div>

      <!-- Gestion abonnements -->
      <div class="card">
        <div class="card-header">
          <div class="card-title"><div class="card-dot"></div>Activer / RÃ©voquer un abonnement</div>
        </div>
        <div class="card-body">
          <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end">
            <div class="form-group" style="flex:1;min-width:160px;margin-bottom:0">
              <label class="form-label">Guild ID</label>
              <input class="form-input" id="admin-guild-id" type="text" placeholder="Ex: 123456789012345678">
            </div>
            <div class="form-group" style="flex:1;min-width:120px;margin-bottom:0">
              <label class="form-label">Plan</label>
              <select class="form-select" id="admin-plan">
                <option value="premium">Premium â€” 2â‚¬</option>
                <option value="pro">Pro â€” 5â‚¬</option>
              </select>
            </div>
            <button class="btn btn-primary btn-sm" onclick="adminActivateSub()">Activer</button>
            <button class="btn btn-red btn-sm" onclick="adminRevokeSub()">RÃ©voquer</button>
          </div>
        </div>
      </div>

      <!-- â•â• GROQ API â€” ClÃ©s & Fallback (Super Admin uniquement) â•â• -->
      <div class="card">
        <div class="card-header">
          <div class="card-title"><div class="card-dot"></div>Groq API â€” ClÃ©s &amp; Fallback Status</div>
          <div class="card-meta">4 CLÃ‰S Â· SUPER ADMIN</div>
        </div>
        <div class="card-body">

          <!-- Avertissement sÃ©curitÃ© -->
          <div style="margin-bottom:16px;padding:10px 14px;background:rgba(255,80,80,0.08);border:1px solid rgba(255,80,80,0.25);border-radius:8px;display:flex;align-items:center;gap:10px">
            <span style="font-size:16px">ğŸ”’</span>
            <div style="font-size:11.5px;color:var(--text2);line-height:1.5">
              Les clÃ©s Groq sont des secrets serveur stockÃ©s dans le fichier <code style="font-family:'Space Mono',monospace;color:var(--accent);font-size:10.5px">.env</code>.
              Elles ne sont <strong>jamais exposÃ©es</strong> cÃ´tÃ© client. Ce panneau affiche uniquement leur statut d'utilisation.
            </div>
          </div>

          <!-- Tableau des clÃ©s -->
          <div class="key-row">
            <div class="key-num">KEY 1</div>
            <div class="key-details">
              <div class="key-name">ClÃ© principale â€” Llama 3.3 70B &amp; Llama 4 Scout</div>
              <div style="font-size:10px;color:var(--text3);margin-top:2px">Usage : rÃ©ponses support IA, traduction temps rÃ©el, rÃ©sumÃ©s tickets</div>
              <div class="key-track"><div class="key-fill low" data-width="23%" style="width:0"></div></div>
            </div>
            <div class="key-pct">23%</div>
            <span class="key-badge on">ACTIF</span>
          </div>

          <div class="key-row">
            <div class="key-num">KEY 2</div>
            <div class="key-details">
              <div class="key-name">Fallback 1 â€” MÃªmes modÃ¨les (Llama 3.3 70B / Scout)</div>
              <div style="font-size:10px;color:var(--text3);margin-top:2px">Usage : bascule automatique si KEY 1 atteint la limite de dÃ©bit</div>
              <div class="key-track"><div class="key-fill low" data-width="0%" style="width:0"></div></div>
            </div>
            <div class="key-pct">0%</div>
            <span class="key-badge off">STANDBY</span>
          </div>

          <div class="key-row">
            <div class="key-num">KEY 3</div>
            <div class="key-details">
              <div class="key-name">Fallback 2 â€” GPT OSS 20B &amp; Llama 4 Scout</div>
              <div style="font-size:10px;color:var(--text3);margin-top:2px">Usage : bascule si KEY 1 &amp; KEY 2 indisponibles â€” modÃ¨les alternatifs open-source</div>
              <div class="key-track"><div class="key-fill low" data-width="0%" style="width:0"></div></div>
            </div>
            <div class="key-pct">0%</div>
            <span class="key-badge off">STANDBY</span>
          </div>

          <div class="key-row">
            <div class="key-num">KEY 4</div>
            <div class="key-details">
              <div class="key-name">Fallback 3 â€” GPT OSS 20B &amp; Kimi K2</div>
              <div style="font-size:10px;color:var(--text3);margin-top:2px">Usage : dernier recours â€” garantit la continuitÃ© de service 24/7</div>
              <div class="key-track"><div class="key-fill low" data-width="0%" style="width:0"></div></div>
            </div>
            <div class="key-pct">0%</div>
            <span class="key-badge off">STANDBY</span>
          </div>

          <!-- Rappel configuration -->
          <div style="margin-top:16px;padding:12px 14px;background:var(--surface);border:1px solid var(--border);border-radius:8px">
            <div style="font-size:10px;font-family:'Space Mono',monospace;color:var(--accent);margin-bottom:6px">âš™ï¸ CONFIGURATION</div>
            <div style="font-size:11.5px;color:var(--text2);line-height:1.7">
              Les clÃ©s sont dÃ©finies dans <code style="font-family:'Space Mono',monospace;color:var(--accent);font-size:10.5px">.env</code> :
              <code style="display:block;margin-top:6px;padding:6px 10px;background:var(--bg);border-radius:6px;font-size:10.5px;color:var(--text3);font-family:'Space Mono',monospace">
                GROQ_API_KEY_1=gsk_...<br>
                GROQ_API_KEY_2=gsk_...<br>
                GROQ_API_KEY_3=gsk_...<br>
                GROQ_API_KEY_4=gsk_...
              </code>
            </div>
          </div>

        </div>
      </div>
    </div>

  </div><!-- .main -->
</div><!-- .app -->

<script>
// Fonctions super admin inline (simples, pas besoin de module sÃ©parÃ©)
async function adminActivateSub() {
  const guildId = document.getElementById("admin-guild-id")?.value?.trim();
  const plan = document.getElementById("admin-plan")?.value;
  if (!guildId) return showToast("Entrez un Guild ID", "warn");
  try {
    await apiPost("/internal/admin/activate-sub", { guild_id: guildId, plan });
    showToast(`Abonnement ${plan} activÃ© pour ${guildId}`, "success");
  } catch (e) { showToast("Erreur: " + e.message, "error"); }
}

async function adminRevokeSub() {
  const guildId = document.getElementById("admin-guild-id")?.value?.trim();
  if (!guildId) return showToast("Entrez un Guild ID", "warn");
  if (!confirm(`RÃ©voquer l'abonnement de ${guildId} ?`)) return;
  try {
    await apiPost("/internal/revoke-sub", { guild_id: parseInt(guildId) });
    showToast(`Abonnement rÃ©voquÃ© pour ${guildId}`, "success");
  } catch (e) { showToast("Erreur: " + e.message, "error"); }
}
</script>

</body>
</html>
